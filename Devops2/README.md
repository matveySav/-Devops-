# Лаба 2 по девопсу
## Плохие практики по работе с Dockerfile
```
FROM ubuntu:latest

WORKDIR /app

RUN apt-get update && apt-get install -y  python3

ENV password=12345
```
1. Мы используем тег `latest`, для указания родительского образа, что не очень хорошо, поскольку это не гарантирует, что мы действительно установим последнюю версию, а также, в зависимости от того, когда мы будем создавать образ по этому докерфайлу, версия родительского образа может отличаться.
2. Мы устанавливаем переменную окружения `password`, пусть это будет какая-то важная информация для нашего проекта, когда мы передаем её значение напрямую в докерфайле, если кто-то завладеет докерфайлом, то он завладеет этой секретной информацией, что не есть хорошо.
3. Также, здесь мы не указываем `USER`, поэтому по умолчанию,команды в контейнере будут исполняться от `root'а`, значит если кто-то получить доступ к контейнеру, он будет иметь права `root'a`и сможет делать с ним почти что угодно (Украсть информацию, ресурсы, установить что-либо в своих целях).
### Тестируем
Сначала собираем образ, даем ему имя bad_practice (как можно видеть 2 слоя взялись з кеша, т.к. собираю образ не впервый раз)

![image](https://github.com/user-attachments/assets/07299c88-4e5c-4f49-a5f8-64945dcf22a5)

После по id образа запускаю в интерактивном режиме (чтобы удобнее было смотреть, а не выводить через `docker exec`) контейнер (кстати здесь заметил, что id образа dockertest3 совп. с только что созданным bad_practice, значит этот образ я собрал в первый раз и новый образ не занимает память, ввиду своей идентичности)

![image](https://github.com/user-attachments/assets/074be3cf-e4b1-437d-8f30-d1320e3cc4a1)

Здесь можно увидеть, что мы зашли под рутом, находимся в директории `/app`, имеем питон, переменная окружения `password` равна 12345, как мы и установили. Т.е. если кто-то вот так получит доступ к контейнеру, он сможет под рутом достать любую информацию из контейнера.

## Исправление плохих практик
```
FROM ubuntu:24.04

WORKDIR /app

RUN apt-get update && apt-get install -y  python3.12

RUN useradd -ms /bin/bash custom_user

USER custom_user

ENV password=/home/matveysav/labs/dockerTest/password
```
1. Здесь вместо тега `latest`, мы указываем конкретную версию(, а также конкретную версию питона, логика та же, что и с родительским образом).
2. В качестве переменной окружения `password` мы указываем путь к файлу с самим паролем, таким образом потеря докерфайла не будет угрозой безопасности (по крайней мере не такой серьезной).
3. После установки питона мы создаем пользователя и переходим на него, таким образом, если кто-то получит доступ к контейнеру, его возможности будут сильно ограничены, так как он будет действовать от лица этого пользвоателя.

### Тестируем

Собираем образ, даем ему имя good_practice, запускаем контейнер, смотрим, что в нем есть.

![image](https://github.com/user-attachments/assets/98e2b3d5-7ed9-43b1-98ab-6bfe645ba404)

![image](https://github.com/user-attachments/assets/064d444e-a244-423a-bfe6-9cbb34ebf7bb)

Видим, что версия убунту 24.04, питон 3.12, переменная окружения теперь содержить путь, а не сам `password`, а также мы находимся под `custom_user'ом`. Как видим, все работает.

## Плохие практики по работе с контейнерами

1. Контейнеры должны быть статичны, то есть вся их конфигурация, какая есть в образе, не должна меняться, контейнеры должны легко перезапускаться, останавливаться, запускаться снова и все это без потери данных. Потому плохая практика по работе с контейнерами - это изменять, что либо внутри живого контейнера (изменения не сохранятся при перезапуске или остановке).
2. Выполнение нескольких процессов в докер контейнере, поскольку это делает отладку, поиск ошибок и масштабирование сложнее.

## Итоги

Были определены 3 плохие практики по работе с Dockerfile'ом, которые были исправлены. Также были предложены плохие практики по работе с контейнерами, таким образом все пункты лабораторной работы были выполнены и зафиксированы в отчете.
